<!DOCTYPE html>
<html>
<head>
    <title>Citizen Feedback Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <h2>Dashboard Overview</h2>

    <div>
        <h3>Topic Distribution</h3>
        <canvas id="topicChart"></canvas>
    </div>

    <div>
        <h3>Urgency Levels</h3>
        <canvas id="urgencyChart"></canvas>
    </div>

    <div>
        <h3>Sentiment Analysis</h3>
        <canvas id="sentimentChart"></canvas>
    </div>

    <div>
        <h3>Feedback Map</h3>
        <iframe src="/static/citizen_feedback_map.html" width="100%" height="500px"></iframe>
    </div>

    <br>
    <a href="/">Submit More Feedback</a>

    <script>
        async function fetchData(url) {
            const response = await fetch(url);
            return response.json();
        }

        async function updateCharts() {
            const topicData = await fetchData('/api/topic_distribution');
            const urgencyData = await fetchData('/api/urgency_levels');
            const sentimentData = await fetchData('/api/sentiment_analysis');

            topicChart.data = topicData;
            urgencyChart.data = urgencyData;
            sentimentChart.data = sentimentData;

            topicChart.update();
            urgencyChart.update();
            sentimentChart.update();
        }

        const topicChart = new Chart(document.getElementById('topicChart'), {
            type: 'bar',
            data: {}, // Initial empty data
            options: {}
        });

        const urgencyChart = new Chart(document.getElementById('urgencyChart'), {
            type: 'pie',
            data: {},
            options: {}
        });

        const sentimentChart = new Chart(document.getElementById('sentimentChart'), {
            type: 'line',
            data: {},
            options: {}
        });

        // Update charts every 10 seconds
        setInterval(updateCharts, 10000);
        updateCharts(); // Initial load
    </script>
</body>
</html>
